\documentclass[]{scrreprt}
%\usepackage{amsmath,amsfonts,graphicx}
%\usepackage{multirow}
%\usepackage{pslatex}
%\usepackage{tabularx}
%\usepackage{comment}
%\usepackage{xspace}
\usepackage{array}
\usepackage{caption}

\RequirePackage{fix-cm}
\usepackage{graphicx}
\usepackage{color,soul}
\usepackage{todonotes}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{empheq}
\usepackage{mathrsfs}
\usepackage{natbib}
\usepackage{listings}
\usepackage{rotating}
\usepackage{hyperref}
\usepackage{epstopdf}
\usepackage{url}

\usepackage{longtable}

\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}}

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\graphicspath{
{figures/}
}

\newcommand{\uo}{\mbox{UO\textsubscript{2}}\xspace}

\setcounter{secnumdepth}{3}

\newcommand{\moose}{{MOOSE}}
\newcommand{\redback}{{REDBACK}}
\newcommand{\pd}{\ensuremath{\partial}}
\newcommand{\pdiff}[2]{\ensuremath{\pd_{#2} #1}}
\newcommand*\widefbox[1]{\fbox{\hspace{1em}#1\hspace{1em}}}


\begin{document}

\newif\ifshowallderivations % flag=False to get published doco, True to see more derivations
\showallderivationstrue
%\showallderivationsfalse

\begin{titlepage}
	\centering
	%\includegraphics[width=0.15\textwidth]{example-image-1x1}\par\vspace{1cm}
	{\scshape\LARGE Theory Manual \par}
	\vspace{1cm}
	%{\scshape\Large Final year project\par}
	\vspace{1.5cm}
	{\Huge\bfseries \redback{} \par}
	\vspace{0.5cm}
	{\large\bfseries Rock mEchanics with Dissipative feedBACKs\par}
	\vspace{2cm}
	{\Large\itshape Thomas Poulet\hspace{2cm}Manolis Veveakis\par}
	\vspace{0.5cm}
	{\Large\itshape CSIRO\hspace{4cm}UNSW\par}
	\vfill
	Collaborators (in chronological order):\par
	Martin Paesold (UWA) \par
	Mustafa Sari (UNSW)

	\vfill

% Bottom of the page
	{\large \today\par}
\end{titlepage}

%\title{Redback Theory Manual}
%\author{Thomas Poulet \\ CSIRO
%	\and Manolis Veveakis \\ UNSW}
%
%\maketitle

\tableofcontents

%%%
\chapter{Introduction}

The \redback{} application was developed to model multi-physics \textit{Rock mEchanics with
Dissipative feedBACKs} in a tightly coupled manner. It is based on the Multi-physics Object Oriented Simulation Environment \moose{}\footnote{http://mooseframework.org} \citep{Gaston2009} which proposes a powerful and flexible platform to solve multi-physics problems implicitly and in a tightly coupled manner on unstructured meshes. \moose{} aims at providing a wide range of modules to model various physical phenomena, including rock mechanics, which are as flexible as possible and can be easily coupled together. By comparison, \redback{} is
The philosophy behind \redback{} is to focus on a non-dimensional formulation of the problem in order to focus on the physical processes at play

This document is a work-in-progress and does not go into all details. Real applications have recently been published that explain specifically the mechanical model \citep{Poulet2016a} and the model including the chemical terms \citep{Poulet2016}. Any contribution is much welcome, feel free to contact us.



\chapter{Governing equations}
\label{chapter:gov_eqs}

\section{Conventions}
In this document we assume that stresses are taken positive in tension and pore pressure is positive ($p_f>0$). Index notation is used. The indices used are $i$, $j$, $k$, $l$. All other letters or character-strings appearing as indices belong to the symbol used and are not subject to the index notation rules.
\redback{} is using a set of equations that are written for a biphasic material, namely a solid and a fluid phase irrespective of the processes involved, e.g. chemical reactions that produce different kinds of solids and fluids.

\section{System of equations}
The system in its final form is
\begin{subequations}
\label{eq:final_system_of_equations_dimensionless}
\begin{empheq}[box=\widefbox]{align}
  0 &= \pdiff{\sigma^{\prime}_{ij}}{j} - \pdiff{p_f}{i} + b_i, \\
  0 &= \pdiff{p_f}{t} + Pe\: \bar{v}_i^{\beta} \pdiff{p_f}{i} -
  Pe\:\bar{v}^{\Lambda}_i \pdiff{T}{i} - \pdiff{\left[\frac{1}{Le} \pdiff{
  p_f}{i} \right]}{i} \\ \nonumber
  ~ & \qquad\qquad - \Lambda_m \pdiff{T}{t} +
  \frac{Pe\:\dot{\epsilon_V}}{\bar{\beta}^*} -\frac{1}{Le_{chem}}
  \omega_F, \\
  0 &= \pdiff{T}{t} + Pe\:\bar{v}^{m}_i\pdiff{T}{i} - \pd_{ii}c^*_{th}\pd_{ii} T - Gr
  \: \sigma_{ij}^{pl}\dot{\epsilon}_{ij}^{\,pl}  \\ \nonumber
  ~ & \qquad\qquad + Da_{endo}\: (1 - s)(1 - \phi)e^{\frac{Ar_F\:\delta T}{1+\delta T}} \\ \nonumber
  ~ & \qquad\qquad - Da_{exo}\:\: s  (1 - \phi)\Delta \phi_{chem} e^{\frac{Ar_R\:\delta T}{1+\delta T}}.
\end{empheq}
\end{subequations}

All dimensionless groups are defined in Tab.~\ref{tab:dimensionless_nbs} and
\begin{align*}
  \bar{\beta}\;\;\:&= (1-\phi)\beta_s + \phi\beta_f, \\
  \bar{\beta}^* \;\: &= \bar{\beta}\:\sigma_{ref}, \\
  \bar{v}_i^{\beta} \;\: &= (1-\phi)\frac{\beta_s}{\bar{\beta}} v_i^s +
    \phi\frac{\beta_f}{\bar{\beta}}v_i^f, \\
  \bar{v}^{\Lambda}_i \:\: &= (1-\phi) \Lambda_s v_i^s +
    \phi \Lambda_f v_i^f,\\
  \bar{v}^{m}_i \:\: &= (1-\phi) \frac{\rho_s}{\bar{\rho}} v_i^s + \phi \frac{\rho_f}{\bar{\rho}} v_i^f, \\
  \omega_F^{*} \: &= \frac{\omega_F M_{AB} e^{Ar}}{\rho_{AB} k_F} = (1-\phi)(1-s)\exp\left(\frac{Ar_F \: \delta T}{1 + \delta T}
  \right), \\
  \dot{\epsilon}^{vp}_{ij} \; &= \dot \epsilon_0 \: \exp\left( \frac{Ar \: \delta
  T}{1 + \delta T}\right) \sqrt{ \left\langle\frac{q -
  q_Y}{\sigma_{ref}}\right\rangle^{2m} + \left\langle\frac{p
  - p_Y}{\sigma_{ref}}\right\rangle^{2m}} \frac{\partial f}{\partial
    \sigma_{ij}}.
\end{align*}

% \omega_R \;\: &= (1-\phi)\:s\:\Delta \phi_{chem}\exp\left(\frac{Ar_R \: \delta T}{1 + \delta T} \right), \\
All symbols are defined in Tab.~\ref{tab:symbols}.

The total porosity $\phi$ is expressed as the sum of its initial value, $\phi_0$,
and the newly created interconnected pore volume. For simplicity reasons, all porosity is assumed to be interconnected (or at least up to the point this document was written). Pore volume can be created
by mechanical ($\Delta\phi_{mech}$) and chemical ($\Delta \phi_{chem}$)
processes such that the total porosity reads
\begin{eqnarray}
    \label{eq:porosity}
    \phi = \phi_0 + \Delta\phi_{mech} + \Delta\phi_{chem} = \frac{V_{B}}{V},
\end{eqnarray}
where $V_B$ is the volume occupied by fluid $B$.  The evolution of mechanical
porosity contains two components, a plastic part $\Delta
\phi^{vp}_{mech}=\epsilon^{pl}_V$, with $\epsilon^{pl}_V$ the volumetric plastic strain, and an
elastic one $\Delta \phi^{e}_{mech}=(1-\phi)\left( \beta_s \Delta p_f -
\lambda_s \Delta T \right)$
where $\beta_s$ and $\lambda_s$ are compressibility and
thermal expansion coefficients of the solid phase, respectively.

\section{Rescaling}
\label{sec:rescaling}
A particularity of \redback{} is to work with dimensionless parameters, in line with the purpose of studying system stabilities. As such, the variables used in the final system of equation (Eq.~\ref{eq:final_system_of_equations_dimensionless}) are all dimensionless and defined as such:
\begin{subequations}
  \label{eq:dimensionless_defs}
  \begin{align}
  p^* &= \frac{p_f}{\sigma_{ref}}, \\
  T^* &= \frac{T-T_{ref}}{\delta T_{ref}}, \\
  x^* &= \frac{x}{x_{ref}}, \\
  t^* &= \frac{c_{th,ref}}{x^2_{ref}}t, \\
  V^* &= \frac{V}{V_{ref}}.
  \end{align}
\end{subequations}
with $c_{th} = \alpha / (\rho C_p)_m$. The derivations of those dimensionless variables is detailed in Sec.~\ref{chapter:derivations}.

Note that the time can in turn be rescaled a second time for numerical reasons (see Sec.~\ref{subsec:time_rescaling}).


\section{Chemical damage}
\label{sec:chem_damage}

Thermally activated chemical reactions are allowed to take place and
in this work we concentrate on (de-)hydration reactions of the form
\begin{equation}
  \label{eq:reaction}
  \zeta_1 AB_{s}
  \overset{\omega_F}{\underset{\omega_R}{\rightleftharpoons}} \zeta_2 A_{s} + \zeta_3 B_{f},
\end{equation}
where the subscripts $s$ and $f$ refer to solid and fluid phases and $\zeta_i$
$(i=1,2,3)$ are stoichiometric coefficients.  The reaction
equation~\eqref{eq:reaction} states that the solid $A$ can release/bind the
component $B$ into/from the fluid phase which increases/reduces the pore pressure.

\begin{figure}
  \centering
  \includegraphics[width=1\textwidth]{figures/Reversible.png}
 % \includegraphics[width=0.45\textwidth]{figures/Reaction_rate.pdf}
  \caption{(a) Schematic explanation of the activation enthalpies of the forward and reverse reactions, and the enthalpy of the reaction. (b) Evolution of the reaction rates of the reactants (black curve) and the products (blue curve) towards the equilibrium rate.}
  \label{fig:Reversible}
\end{figure}

The kinetics of the decomposition reaction~\eqref{eq:reaction} are assumed
to follow a standard Arrhenius dependency on temperature
\citep{Poulet2014}. As a result, the rates of the forward, $\omega_F$, and
reverse reaction, $\omega_R$ (let $\zeta_1=\zeta_2=\zeta_3=1$) can
be expressed as \citep{Alevizos2014}
\begin{subequations}
\label{eq:reaction_rates_txt}
\begin{align}
  \omega_F &=  \frac{\rho_{AB}}{M_{AB}} (1 - \phi)(1 - s)  k_F e^{-\Delta H_{act}^F/RT}, \\
  \omega_R &=  \frac{\rho_{A} \rho_{B}}{M_A M_B} (1 - \phi) s \Delta\phi_{chem}
  k_R e^{-\Delta H_{act}^R/RT},
\end{align}
\end{subequations}
where $\rho_i$ and $M_i$ $(i = A, B, AB)$ are the densities and molar masses of
the respective constituent,
$k_F,k_R$, $\Delta H_{act}^F,\Delta H_{act}^R$ are the pre-exponential factors and activation enthalpies
of the forward and reverse reaction,
$\phi$ is porosity and $\Delta\phi_{chem}$ denotes change in porosity due to
chemical processes. We define the solid ratio
\begin{eqnarray}
    \label{eq:s}
    s = \frac{V_{A}}{V_s} = \frac{V_{A}}{(1-\phi) V},
\end{eqnarray}
where $V$ is a representative volume, $V_A$ and $V_s$ is the volume of solid
phase $A$ and all solid within $V$, respectively. The solid ratio is a measure
of the extend of reaction~\eqref{eq:reaction}. Subsequently, the total
reaction rate is
\begin{equation}
 \label{eq:reaction_rate_total}
\omega = \left[(1 - s) - s  \Delta \phi_{chem} \frac{\rho_{A}
\rho_{B}}{\rho^2_{AB}} \frac{M^2_{AB}}{M_A M_B} K^{-1}_c e^{\Delta H_{r}/RT}
\right] (1 - \phi) \frac{\rho_{AB}}{M_{AB}} k_F e^{-\Delta H_{act}^F/RT}
\end{equation}
where $K_c = k_F/k_R$ and $\Delta H_{r} = \Delta H_{act}^R - \Delta H_{act}^F$.  The expressions for the
dependency of the porosity $\phi$ and solid ratio $s$ on the reaction kinetics
are described in detail in \cite{Alevizos2014} and briefly summarized here.

We assume the following relations for the partial molar reaction rates of the
species involved
\begin{subequations}
\label{eq:js}
\begin{align}
  \omega_{AB} &= - \left[ \frac{\rho_{AB}}{M_{AB}} (1 - \phi)(1 - s)
  \right]^{\zeta_1} k_F \exp(-\Delta H_{act}^F/RT), \\
  \omega_A &= \left[ \frac{\rho_{A}}{M_A} (1 - \phi) s \right]^{\zeta_2} k_A \exp(-\Delta H_{act}^R/RT), \\
  \omega_B &= \left[ \Delta\phi_{chem} \frac{\rho_{B}}{M_B} \right]^{\zeta_3} k_B
  \exp(-\Delta H_{act}^R/RT),
\end{align}
\end{subequations}
and those rates are linked by the stoichiometry of the considered reaction~\eqref{eq:reaction} as
\begin{equation}
  \label{eq:j_equal}
	-\frac{\omega_{AB}}{\zeta_1} = \frac{\omega_A}{\zeta_2} = \frac{\omega_B}{\zeta_3}.
\end{equation}
From Eqs.~(\ref{eq:js}-\ref{eq:j_equal}) and for $\zeta_1=\zeta_2=\zeta_3=1$ we
derive the poro-chemical model
\begin{subequations}
\label{eq:s_phi_chem}
\begin{align}
  \Delta \phi_{chem} &= A_{\phi} \frac{1-\phi_0}{1 + \frac{\rho_{B}}{\rho_{A}} \frac{M_{A}}{M_{B}} \frac{1}{s}}, \\
  s &= \frac {\omega_{rel}} {1+\omega_{rel}},\\
  \omega_{rel} &= \frac{\rho_{AB}}{\rho_{A}} \frac{M_{A}}{M_{AB}} K_c \exp
  \left( \frac{\Delta H_{r}}{RT} \right),
\end{align}
\end{subequations}
where
$A_{\phi}$ is a coefficient that determines the amount of the
interconnected pore-volume (porosity) created due to the reaction. We assume
that all the fluid generated contributes to the interconnected pore volume, and
thus set $A_{\phi} = 1$.




\begin{table}
  \todo[inline]{Damkohler numbers to check}
  \caption{Dimensionless parameters used in \redback{}. The coefficient $\delta$ is defined
such that $T^{\star} = (T-T_{ref})/(\delta T_{ref})$}
\label{tab:dimensionless_nbs}
%\begin{tabular}{@{} l p{0.18\textwidth} l p{0.52\textwidth} @{}}
\begin{tabular}{| L{1.2cm} | L{2.2cm} | L{6cm} | L{5cm} |}
\hline\noalign{\smallskip}
Group & Name & Definition & Interpretation \\
\noalign{\smallskip}\hline\hline\noalign{\smallskip}
$Gr$ & Gruntfest number & $\frac{\chi\sigma_{ref}}{\alpha \delta T_{ref} (\rho C_p)_m}$ & ratio of mechanical rate converted into heat over rate of diffusive processes \\ \hline
$Da_{endo}$ & Endothermic Damk\"{o}hler number & $\frac{A_{endo} h_{endo} \rho_{AB} x^2_{ref}}{ \delta T_{ref} c_{th,ref}(\rho C_p)_m}$ & ratio of endothermic reaction rate over rate of diffusive processes \\ \hline
$Da_{exo}$ & Exothermic Damk\"{o}hler number & $\frac{A_{exo} h_{exo} \rho_{AB} x^2_{ref}}{\delta T_{ref} c_{th,ref}(\rho C_p)_m}$ & ratio of exothermic reaction rate over rate of diffusive processes \\ \hline
$Ar$ & Arrhenius number & $\Delta H_{mech}/(R T_{ref})$ & Ratio of activation enthalpy over thermal energy \\ \hline
$Ar_F$ & Forward Arrhenius number & $\Delta H_{act}^F/(R T_{ref})$ & Ratio of activation enthalpy of forward reaction over thermal energy \\ \hline
$Ar_R$ & Reverse Arrhenius number & $\Delta H_{act}^R/(R T_{ref})$ & Ratio of activation enthalpy of reverse activation energy over thermal energy \\ \hline
$Le$ & Lewis number & $c_{th}/c_{hy}=\frac{\mu_f\:c_{th,ref}\:\beta^*_m}{\kappa \: \sigma_{ref}}$ & Ratio of thermal over mass diffusivities \\ \hline
$Le_{chem}$ & Chemical Lewis number & $\frac{c_{th}\sigma_{ref}\beta_m }{x^2_{ref} A_{endo}}\frac{\rho_{B}}{\rho_{AB}} \frac{M_{AB}}{M_{B}} \left( \frac{\rho_B}{\rho_f} - \frac{\rho_B}{\rho_s}\right)e^{-Ar_F}$ & Ratio of thermal over chemical diffusivity of forward reaction \\ \hline
$\bar{\Lambda}_a$ & Thermal pressurisation coefficient of $a$ & $\frac{\lambda_a}{\beta_m}\frac{\delta \:T_{ref}}{\sigma_{ref}}$ & Normalised thermal pressurisation coefficient, with $\lambda_a$ the thermal expansion of $a$ and $\beta_m$ the mixture's compressibility \\ \hline
$Pe$ & P\'{e}clet number & $x_{ref}V_{ref}/c_{th,ref}$ & Ratio of temperature advection rate over diffusion rate \\
\noalign{\smallskip}\hline
\end{tabular}
\end{table}


\chapter{Code architecture}
\label{chapter:code}
\section{Kernels}
Here is the list of all kernels implemented in \redback{} to solve the system of Eq.~\ref{eq:final_system_of_equations_dimensionless}:
\begin{align*}
  \\ \\
  0 &= \overbrace{ \pdiff{\sigma^{\prime}_{ij}}{j} - \pdiff{p_f}{i} + b_i }^{\begin{rotate}{10}RedbackStressDivergenceTensor\end{rotate}} , \\
  \\
  0 &= \overbrace{ \pdiff{p_f}{t} }^{\begin{rotate}{15}TimeDerivative\end{rotate}}
       + \overbrace{ Pe\: v^p_i \pdiff{p_f}{i}
       - Pe\:v^T_i \pdiff{T}{i} }^{\begin{rotate}{15}RedbackMassConvection\end{rotate}}
       - \overbrace{ \pdiff{\left[\frac{1}{Le} \pdiff{p_f}{i} \right]}{i} }^{\begin{rotate}{15}RedbackMassDiffusion\end{rotate}}
       \\ \nonumber
  ~ & \qquad
  - \underbrace{ \Lambda \pdiff{T}{t} }_{\begin{rotate}{-15}RedbackThermalPressurization\end{rotate}}
  \qquad\quad+ \qquad \underbrace{ \frac{Pe\:\dot{\epsilon_V}}{\bar{\beta}\:\sigma_{ref}}  }_{\begin{rotate}{-15}RedbackPoromechanics\end{rotate}}
  \: - \: \underbrace{ \frac{1}{Le_{chem}}  }_{\begin{rotate}{-15}RedbackChemPressure\end{rotate}}
  \omega_F, \\ \\ \\
  0 &= \underbrace{ \pdiff{T}{t}   }_{\begin{rotate}{-25}TimeDerivative\end{rotate}}
  +  \underbrace{ Pe\:\bar{v_i}\pdiff{T}{i}   }_{\begin{rotate}{-25}RedbackThermalConvection\end{rotate}}
  - \underbrace{ \pd_{ii} c^*_{th}\pd_{ii}T   }_{\begin{rotate}{-25}RedbackThermalDiffusion\end{rotate}}
  - \underbrace{ Gr \: \sigma_{ij}^{pl}\dot{\epsilon}_{ij}^{\,pl}  }_{\begin{rotate}{-25}RedbackMechDissip\end{rotate}}
  + \underbrace{ Da_{endo}\: \omega_F }_{\begin{rotate}{-25}RedbackChemEndo\end{rotate}}
  - \underbrace{ Da_{exo}\: \omega_R. }_{\begin{rotate}{-25}RedbackChemExo\end{rotate}} \\ \\ \\
\end{align*}

Note that this expression of the system of equation does not include the time rescaling factor (see following Sec.~\ref{subsec:time_rescaling}), which explains the presence of a RedbackThermalDiffusion kernel instead of using the default Diffusion kernel from \moose{}.

\subsection{Time rescaling}
\label{subsec:time_rescaling}
The time used in \redback{} is dimensionless and defined in Eq.~\ref{eq:dimensionless_defs}. For numerical reasons however, it can sometimes be useful to rescale time again by introducing $t'$ such that
\begin{equation}
  t^* = t' \times \text{time\_factor}.
\end{equation}
Using the newly defined time $t'$ is equivalent to multiplying all the kernels, other than the time derivatives, of Eq.~\ref{eq:final_system_of_equations_dimensionless}b and Eq.~\ref{eq:final_system_of_equations_dimensionless}c by \textit{time\_factor}. This functionality is required for cases when the initial residual computation is too low and prevents \moose{} from converging to an accurate solution. It is convenient in those cases (e.g. for convection simulations) to use a large factor \textit{time\_factor} to increase the initial value of the residual and therefore allow \moose{} to improve that residual down to a low value which will ensure enough numerical precision.

The \textit{time\_factor} is defined for each kernel concerned but should only be input as a global variable in your input file.
%\lstset{language=Python}
\begin{lstlisting}
[GlobalParams]
  time_factor = 1.e-3
[]
\end{lstlisting}

Note that the real time $t$ is then related to the time $t'$ used in the \redback{} simulations by
\begin{equation}
  t = \text{time\_factor}\times\frac{x^2_{ref}}{c_{th,ref}}t'
\end{equation}

\section{Porosity}
Porosity plays a particular role as its evolution depends on the mechanical, thermal, and hydraulic process models. As such, the total porosity evolution can not be handled within a material class unfortunately since it has components updated in more than one material. With the RedbackMechMaterial class already derived from the RedbackMaterial class, we can not create a dependency the other way around as it would create a circular dependency problem. There are at least two ways of working around that problem:
\begin{enumerate}
\item Porosity can be treated as an extra variable to solve for.
\item Porosity can be treated as an AuxKernel, which allows us to update it with various components calculated in separate material, and yet have all materials use the total porosity (updated with delay obviously).
\end{enumerate}
In the first case the porosity evolution (and dependency on all process models) will be solved rigorously, but this will come at a greater computational cost. This is probably the neatest solution to handle the most generic case when porosity might be strongly dependent on all process models, but this is not the principal scenario we are aiming with the current development of Redback. We are indeed focusing on the case described in Sec.~\ref{chapter:gov_eqs}, where the porosity is much more strongly dependent on chemistry (which produces fluid and can therefore raise $\phi$ to $1$) than it is on temperature and pore pressure (inducing minor variations of $\phi$). As a result, we decided to implement the second option and handle the total porosity as an AuxVariable updated by an AuxKernel. This option provides more flexibility to compute the total porosity more or less accurately by updating the AuxKernel more or less frequently. At the moment we're treating the porosity in an explicit manner and only update it at the end of each step. This is equivalent to say that we neglect the mechanical update of the porosity during a single step and only consider its chemical variation (since it is the main evolution for the cases we consider).

\chapter{Tests}
\label{chapter:tests}

\redback{} is tested through a series of tests based on various benchmarks for all physical processes involved: thermal (\textbf{T}), hydraulic (\textbf{H}), mechanical (\textbf{M}), and chemical (\textbf{C}). All tests are found in the \texttt{redback/tests} directory
\section{Benchmark 1 - T}

This benchmark (\texttt{redback/tests/benchmark\_1\_T}) looks at the temperature equation
\begin{equation}
\frac{\partial T}{\partial t} = \frac{\partial^2 T}{\partial x^2} + Gr . e^{\frac{Ar. \delta.T}{1+\delta.T}}.
\end{equation}

The steady state solution is a generalisation of the classical Bratu problem \citep{Bratu1914} and is controlled by the Gruntfest number $Gr$. Using a bifurcation method \citep{Succombe2015} we can find the critical value of the Gruntfest number as shown on Fig.~\ref{fig:benchmark_1_T_succombe}

\begin{figure}
  \centering
  \includegraphics[width=0.32\textwidth]{benchmark_1_T/benchmark_1_T_succombe_0}
  \includegraphics[width=0.32\textwidth]{benchmark_1_T/benchmark_1_T_succombe_1}
  \includegraphics[width=0.32\textwidth]{benchmark_1_T/benchmark_1_T_succombe_2}
  \caption{"S-curve" of the steady state analysis for \texttt{benchmark\_1\_T} with a) zoom on low values of temperatures, showing the four starting conditions and their expected time evolution, b) zoomed out view of the unsteady branch of the "S-curve" in dashed line, and c) even more zoomed out view for larger values of temperatures, showing the higher steady branch where benchmarks C and D converge.}
  \label{fig:benchmark_1_T_succombe}
\end{figure}

This problem is then solved using \moose{} on a generated 1D mesh from -1 to 1 for different values of $Gr$ and the initial solution of the temperature $T_0$ in the center:
\begin{itemize}
\item $Gr=0.095$ and $T_0=0$. In this case, the system should converge increasingly to a centre temperature $T_a\approx0.109$. This case is treated with the input file \texttt{bench1\_a.i}
\item $Gr=0.095$ and $T_0=0.15$. In this case, the system should converge decreasingly to the same centre temperature $T_b=T_a\approx0.109$. This case is treated with the input file \texttt{bench1\_b.i}
\item $Gr=0.095$ and $T_0=0.25$. In this case, the system should converge increasingly to a large temperature $T_c>1000$. This case is treated with the input file \texttt{bench1\_c.i}
\item $Gr=0.1$ and $T_0=0$. In this case, the system should converge increasingly to an even larger temperature $T_d>T_c>1000$. This case is treated with the input file \texttt{bench1\_d.i}
\end{itemize}

\begin{figure}
  \centering
  \includegraphics[width=0.48\textwidth]{benchmark_1_T/benchmark_1_T_results_A_B.eps}
  \includegraphics[width=0.48\textwidth]{benchmark_1_T/benchmark_1_T_results_C_D.eps}
  \caption{Time evolution of the numerical results for the four benchmarks: a) cases A and B converge to the lower stable branch (see Fig.~\ref{fig:benchmark_1_T_succombe}), while b) cases C and D converge to the upper stable branch.}
  \label{fig:benchmark_1_T_results}
\end{figure}

The numerical results match the theory with the time evolutions shown on Fig.~\ref{fig:benchmark_1_T_results}.

\section{Benchmark 6 - TM}
Those benchmarks look at thermal-mechanical simulations.
\subsection{Problem Description}
by heating of an elastic rod from the back and the front ,this the rod  confined in all sides except  the top As shown in fig~\ref{fig:Benchmark7_cubic}

\begin{figure}
\label{fig:Benchmark6_Rod}
\centering
\includegraphics[width=0.52\textwidth]{benchmark_6_TM/elastic_model_setup}
\caption{This is a caption confining from its sides and the bottom}
\end{figure} .
\subsection{Analytical solution}
The stress in x-axis will be similar to the stress in y-axis whereas the stress in z-axis will be zero since its not confined. because the temperature is increased the rod will expand in z-axis( strain in zz) and that strain calculated  by this equation:
\begin{equation}
\varepsilon_{zz}=\frac{\alpha}{2}\Delta T
\end{equation}
we divided $\alpha$ by $2$ because in this problem we have two dimension (area thermal expansion coefficient) for more information visit this website \hyperref {''https://en.wikipedia.org/wiki/Thermal_expansion''}
from that strain we can caculate the stress in x-axis which is as shown in the equation bellow:
\label{eq:thermal_stress}
\begin{equation}
\sigma_{xx}=\frac{3}{2} \frac{E}{(1-2\nu)} \frac{\alpha}{2}\Delta T
\end{equation}

\ifshowallderivations
	Let's explain this step in details...\\
	$\frac{3}{2}$ is the geometric factor
	%\else
\fi
\subsection{Numerical solution}
This problem is then solved using moose on a generated 3D mesh and a comparison of the numerical results against the analytical solution are shown in the figure bellow.
\begin{figure}
\label{fig:benchmark6_TM_elastic}
  \centering
  \includegraphics[width=0.48\textwidth]{benchmark_6_TM/benchmark_6_TM_bench_TM_elastic_stress_xx}
  \includegraphics[width=0.48\textwidth]{benchmark_6_TM/benchmark_6_TM_bench_TM_elastic_stress_zz}\\
  \caption{the effect of thermal stress }
 \end{figure}

\section{Benchmark 7 - HM}
Those benchmarks look at hydro-mechanical simulations.

\subsection{Elastic}
\label{subsec:bench_7_elastic}
 This benchmark (\texttt{redback/tests/benchmark\_7\_ HM}) looks at Undrained odometer test (in finite strain) to compare with \moose poromechanics test (Infinitesimal strain).
\subsubsection{Problem Description}

A cubic single-element fully-saturated sample has roller BCs applied to its sides and bottom.  All the sample's boundaries are impermeable.  A constant downwards (normal) velocity,$v_{z}$, is applied to its top, and the rise in porepressure and effective stress is observed.  (Here $z$ denotes the direction normal to the top face.)  There is no fluid flow in the single element.
Under these conditions, and denoting the height ($z$ length) of the sample by $L$.As shown in fig~\ref{fig:Benchmark7_cubic}

\begin{figure}
  \centering
  \includegraphics[width=0.25\textwidth]{benchmark_7_HM/elastic_model_setupx}
  \caption{Model setup for benchmark~\ref{subsec:bench_7_elastic} showing applied boundary conditions, with all faces but the top constrained in normal displacement, and an applied downwards velocity on the top face.}
  \label{fig:Benchmark7_cubic}
\end{figure}

\subsubsection{Analytical Solution}

To calculate the change in the pore pressure we used this equation
\begin{equation}
P_{\mathrm{f}} = -\frac{Time Factor}{(1-\phi)}\left( v_{z}t/L\right)
\end{equation}
and for the time factor just read \ref{subsec:time_rescaling} for more details
\ifshowallderivations
Lets explain this in details:
\begin{itemize}
\item To calculate the mass balance to mixture(solid and liquid)we  add Eq:~\ref{eq:fluid_mass_balance} and Eq:~\ref{eq:solid_mass_balance} together so we end up with equation (2.1 b)and we solve for isothermal and no convection and no chemical affection and that's lead to the equation bellow:
\item

$ \pdiff{p_f}{t}=- \frac{Pe\:\dot{\epsilon_V}}{ \bar{\beta}\:\sigma_{ref}}$
and from Tab.~\ref{tab:dimensionless_nbs} for dimensionless the equation become

$ \pdiff{p_f}{t}=- \frac{Pe\:\dot{\epsilon_V}}{ \beta_s(1-\phi)}$


\end{itemize}
%\else
\fi
Also we used the finite strain theory \citep[][p.6-7]{Coussy2004}
to calculate the strain in x,y directions,)whereas Moose Poromechanics use infinitesimal transformation theory.
\begin{equation}
\sigma_{xx}^{\mathrm{eff}} = (K - \mbox{$\frac{2}{3}$}G)\left[\left( v_{z}t/L\right)+\left(\frac{1}{2}\left( v_{z}t/L\right)^2\right) \right] \ .
\end{equation}
\begin{equation}
\sigma_{zz}^{\mathrm{eff}} = (K + \mbox{$\frac{4}{3}$}G)\left[\left( v_{z}t/L\right)+\left(\frac{1}{2}\left( v_{z}t/L\right)^2\right) \right] \ .
\end{equation}

\subsubsection{Numerical Solution}

This problem is then solved using moose on a generated 3D mesh for the values bellow:
\begin{itemize}
\item Young's modulus $(E)=3.6$\
\item Poisson's ratio $(\nu) =0.2$\
\item $\Phi=0.1$\
\item $L=1$\
\item Biot Coefficient $(\alpha)=0.3$\
\item P\'{e}clet number $(Pe)=1$\
\item solid compressibility $(\beta_s)=3.7037$\
\item top velocity $(V_z) =0.01$\
\end{itemize}



In moose poromechanics they used  Bulk modulus(K) and shear modulus(G) where:\\

\begin{equation}
E=\frac{9KG}{3K+G•}
\end{equation}
\begin{equation}
\nu=\frac{3K-2G}{2(3K+G)}
\end{equation}
A comparison of the numerical results against the analytical solution are shown in fig~\ref{fig:benchmark7_Elastic}
\begin{figure}
  \centering
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_stress_xx}
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_stress_zz}
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_p0}
  \caption{Comparison of analytical vs numerical results for benchmark~\ref{subsec:bench_7_elastic}}
  \label{fig:benchmark7_Elastic}
\end{figure}

\subsection{Elastic No Porosity }
\label{subsec:bench_7_elastic_no_porosity}

The porosity is kept constant so it is same as the above problem(Elastic)but with changing in the properties :
\begin{itemize}
\item  $E=3.6$\
\item  $\nu =0.2$\
\item $\Phi=0.1$\
\item $L=1$\
\item  $\alpha=0.3$\
\item  $Pe=0.0000009$\
\item  $\beta_s=0.000001$\
\item  $V_z =0.01$\
\end{itemize}

A comparison of the numerical results against the analytical solution are shown in Fig.~\ref{fig:benchmark7_no_porosity}.
\begin{figure}
  \centering
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_no_porosity_stress_xx}
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_no_porosity_stress_zz}
  \includegraphics[width=0.32\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_no_porosity_p0}
  \caption{Comparison of analytical vs numerical results for benchmark~\ref{subsec:bench_7_elastic_no_porosity}}
  \label{fig:benchmark7_no_porosity}
 \end{figure}

\subsection{Elastic Porosity}
\label{subsec:bench_7_elastic_with_porosity}
In this problem the porosity evolves according to Eq.~\ref{eq:solid_mass_balance_2} and that  equation may be solved in closed form   to calculate the small changes in porosity \begin{equation}
\label{eq:Evolution_of_Porosity}
\phi = \phi_o+(1-\phi) \left[ \phi_0+\beta_s (p-p_o) - \epsilon_v \right] \ .
\end{equation}


\ifshowallderivations
	Let's explain this step in details...
	\begin{itemize}
	\item by ignoring  the convection from Eq.~\ref{eq:solid_mass_balance_2} we end up with
	\begin{equation}
  (1-\phi) \frac{\partial \rho_s }{\partial t} - \rho_s\frac{\partial \phi }{\partial t} + \rho_s\frac{\partial( (1-\phi) V^{(1)}_k)}{\partial x_k} = 0
\end{equation}
by simplifying the above equation we end up with
	\item
	\begin{equation}
  (1-\phi) \frac{\partial \rho_s }{\partial t} + \rho_s\frac{\partial(1-\phi) }{\partial t} + \rho_s(1-\phi)\frac{ \partial  V^{(1)}_k}{\partial x_k}+\rho_s  V^{(1)}_k \frac{\partial(1-\phi)}{\partial x_k} = 0
\end{equation}
The last term the equation above is zero since we assume that we have one cell and the porosity is constant with space. so we will end up with

	\item
	\begin{equation}
	(1-\phi) \frac{\partial \rho_s }{\partial t} + \rho_s\frac{\partial(1-\phi) }{\partial t} + \rho_s(1-\phi)\frac{ \partial  V^{(1)}_k}{\partial x_k}=0
	\end{equation}
	by divide the above equation by $\frac{1}{\rho_s(1-\phi)}$ we will gain
	\item
	\begin{equation}
	\frac{1}{\rho_s}\frac{\partial \rho_s }{\partial t} + \frac{1}{(1-\phi)}\frac{\partial(1-\phi) }{\partial t} + \frac{ \partial  V^{(1)}_k}{\partial x_k}=0
	\end{equation}

	from the Equation of the state (EOS)


	\item \begin{equation}
	\frac{1}{\rho_s}\frac{\partial \rho_s }{\partial t}= \beta_s\frac{\partial P_f}{\partial t}
	\end{equation}
	also $ \frac{ \partial  V^{(1)}_k}{\partial x_k}$ is the volumetric strain $\varepsilon_v$ so the equation become
	\item
	\begin{equation}
	\frac{1}{(1-\phi)}\frac{\partial(1-\phi) }{\partial t} +\beta_s\frac{\partial P_f}{\partial t}+\frac{ \partial  V^{(1)}_k}{\partial x_k} =0
	\end{equation}
	by simplifying the above Eq
	\begin{equation}
	-\frac{1}{(1-\phi)}\frac{\partial\phi }{\partial t} +\beta_s\frac{\partial P_f}{\partial t}+\frac{ \partial  V^{(1)}_k}{\partial x_k}
	\end{equation}

	also
	\begin{equation}
	d\phi=(1-\phi)\left[\beta_s dp_f+\epsilon_v\right]
	\end{equation}
	by integrating the above equation :
	\begin{equation}
\phi = \phi_o+(1-\phi) \left[ \phi_0+\beta_s (p-p_o) + \epsilon_v \right] \ .
\end{equation}
	and because we have a compression so the volumetric strain will be negative.
	\begin{equation}
\phi = \phi_o+(1-\phi) \left[ \phi_0+\beta_s (p-p_o) - \epsilon_v \right] \ .
\end{equation}
	\end{itemize}
%\else
\fi
.A comparison of the numerical results against the analytical solution are shown in Fig.~\ref{fig:benchmark7_with_porosity}.
\begin{figure}
  \centering
  \includegraphics[width=0.48\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_porosity_stress_xx}
  \includegraphics[width=0.48\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_porosity_stress_zz}\\
  \includegraphics[width=0.48\textwidth]{benchmark_7_HM/benchmark_7_HM_bench_HM_elastic_porosity_p0}
  \caption{Comparison of analytical vs numerical results for benchmark~\ref{subsec:bench_7_elastic_with_porosity}}
  \label{fig:benchmark7_with_porosity}
 \end{figure}

\section{Benchmark 8 - THM}
\label{subsec:bench_8_THM}
Those benchmarks look at thermal-hydro-mechanical simulations.
\subsection{Analytical solution}
The results are similar to those from Bench-HM elastic in Benchmark-7-HM
 and the stresses need to be augmented by a factor of thermal stress
 thermal stress is represented by this equation:
 \begin{equation}
 \sigma_th=\beta\Delta{T}
 \end{equation}
 where $\beta=\alpha\frac{E}{1-2\nu}$

 so the stresses equation will become :
 \begin{equation}
\sigma_{xx}^{\mathrm{eff}} =\left[ (K - \mbox{$\frac{2}{3}$}G)\left[\left( v_{z}t/L\right)+\left(\frac{1}{2}\left( v_{z}t/L\right)^2\right) \right]\right]+\sigma_{th} \ .
\end{equation}
\begin{equation}
\sigma_{zz}^{\mathrm{eff}} =\left[ (K + \mbox{$\frac{4}{3}$}G)\left[\left( v_{z}t/L\right)+\left(\frac{1}{2}\left( v_{z}t/L\right)^2\right) \right]\right]+\sigma_{th} \ .
\end{equation}
and the pore pressure equation will not change
\begin{equation}
P_{\mathrm{f}} = -\frac{Time Factor}{(1-\phi)}\left( v_{z}t/L\right)
\end{equation}

\subsection{Numerical solution}
This problem is then solved using moose on a generated 3D mesh for the values bellow:
\begin{itemize}
\item Young's modulus $(E)=3.6$\
\item Poisson's ratio $(\nu) =0.2$\
\item $\Phi=0.1$\
\item $L=1$\
\item Biot Coefficient $(\alpha)=0.3$\
\item P\'{e}clet number $(Pe)=10$\
\item solid compressibility $(\beta_s)=3.7037$\
\item top velocity $(V_z) =0.01$\
\item Thermal Coefficient Expansion $\alpha=0.005$\

\end{itemize}
A comparison of the numerical results against the analytical solution are shown in fig \ref{fig:gravity_rho_g_h}
\begin{figure}
\label{fig:benchmark8_THM_elastic}
  \centering
  \includegraphics[width=0.33\textwidth]{benchmark_8_THM/benchmark_8_THM_bench_THM_elastic_stress_xx}
  \includegraphics[width=0.33\textwidth]{benchmark_8_THM/benchmark_8_THM_bench_THM_elastic_stress_zz}\\
  \includegraphics[width=0.33\textwidth]{benchmark_8_THM/benchmark_8_THM_bench_THM_elastic_p0}
  \caption{ Comparison of analytical vs numerical results for elastic with the effect of thermal stress for benchmark~\ref{subsec:bench_8_THM}}
 \end{figure}


\section{Gravity}
\subsection{Gravity}
\label{subsec:gravity rho g h}
\subsubsection{Analytical Solution}
Testing that gravity changes the stress (with depth for example) in the stress divergence kernel
so the stress will be equal to the gravity and can be calculated from this equation
\begin{equation}
\sigma_{zz}=\rho g L
\end{equation}
where: \\
$\rho$ : solid density\\
$g$ : gravitational acceleration \\
$L$ : The length \\
 \begin{equation}
 \sigma_{xx}= K_o(\rho g L)
 \end{equation}
where:
$K_o$ :The ratio of horizontal to vertical stress
\begin{equation}
K_o=\frac{E\nu}{E(1-\nu)}
\end{equation}
\ifshowallderivations
Lets explain the steps in details
\begin{equation}
K_o=\frac{\sigma_{xx}}{\sigma{zz}}
\end{equation}
and
\begin{equation}
\label{eq:ratio of herizontal to vertical stresses }
K_o=\frac{ (K - \mbox{$\frac{2}{3}$}G)\epsilon_{zz}}{(K + \mbox{$\frac{4}{3}$}G)\epsilon_{zz}}
\end{equation}
when:\\
\begin{equation}
K=\frac{E}{3(1-2\nu)}
\end{equation}
\begin{equation}
G=\frac{E}{2(1+\nu)}
\end{equation}
form more information about the two equation above see the table in this website: (https://en.wikipedia.org/wiki/Lam%C3%A9_parameters)
by substitute the two equations above in \ref{eq:ratio of herizontal to vertical stresses } and simplify them we end up with
$K_o=\frac{E\nu}{E(1-\nu)}$

%\else
\fi

\subsubsection{Numerical Solution}
This problem is then solved using moose on a generated 3D mesh for the values bellow:
\begin{itemize}
\item Young's modulus $(E)=5e4$\
\item gravitational acceleration $g =-9.81$\
\item Poisson's ratio $(\nu) =0.2$\
\item $L=1$\
\item  solid density $(\rho=1)$\
\end{itemize}
 a comparison of the numerical results against the analytical solution are shown in the figure \ref{fig:gravity_rho_g_h}
 \begin{figure}
  \centering
  \includegraphics[width=0.48\textwidth]{gravity/gravity_gravity_rho_g_h_stress_xx}
  \includegraphics[width=0.48\textwidth]{gravity/gravity_gravity_rho_g_h_stress_zz}\\
  \caption{gravity ($\rho g h$) changes the stress  }
  \label{fig:gravity_rho_g_h}
\end{figure}

\subsection{Gravity poro stress}
\label{subsec:gravity_poro_stress}
\subsubsection{Analytical Solution}
Testing that gravity changes the stress (with depth for example) in the stress divergence kernel and taking into account pore pressure.
The system is solved analytically as follows:
\begin{equation}
\label{eq:stress_pore_pressure_gravity}
\sigma^{\prime}_{zz}+p_f=\rho g h
\end{equation}
\begin{equation}
p_f=-\frac{Pe}{(1-\phi)\beta}\frac{\sigma^{\prime}_{zz}}{(k+\frac{4G}{3})}
\end{equation}
\begin{equation}
\label{eq:pore_pressure}
\sigma^{\prime}_{xx}=\sigma^{\prime}_{yy}=K_0\sigma^{\prime}_{zz}
\end{equation}
and this gives the solution:
\begin{equation}
\label{eq:pore_pressure_gravity}
P_f=-\frac{Pe \rho g h}{\beta(1-\phi)k^{\prime}-Pe}
\end{equation}
where:\\
$k^{\prime}= (K+\frac{4G}{3})$\\
lets explain the Eq. \ref{eq:pore_pressure_gravity} in more details:\\
\ifshowallderivations
from Eq.\ref{eq:stress_pore_pressure_gravity}and \ref{eq:pore_pressure} we get this equation
\begin{equation}
\sigma^{\prime}_{zz}=\rho g h + \frac{Pe}{\beta(1-\phi)}\frac{\sigma^{\prime}_{zz}}{(K+\frac{4G}{3})}
\end{equation}
by rearrange the equation above we end up with
\begin{equation}
\sigma^{\prime}_{zz}-\frac{Pe}{\beta(1-\phi)}\frac{\sigma^{\prime}_{zz}}{(K+\frac{4G}{3})}=\rho g h
\end{equation}
by simplifying more
\begin{equation}
\sigma^{\prime}_{zz}\left(1-\frac{Pe}{\beta(1-\phi)k^{\prime}}\right)=\rho g h
\end{equation}
and
\begin{equation}
\sigma^{\prime}_{zz}=\frac{\rho g h}{\left(1-\frac{Pe}{\beta(1-\phi)k^{\prime}}\right)}
\end{equation}
by multiply the equation above by $ \frac{\beta(1-\phi)K^{\prime}}{\beta(1-\phi)K^{\prime}}$
we end up with
\begin{equation}
\sigma^{\prime}_{zz}=\frac{(\rho g h)\beta(1-\phi)K^{\prime}}{\beta(1-\phi)K^{\prime}-Pe}
\end{equation}
by substitute the above equation in Eq.\ref{eq:pore_pressure} we get the Eq. \ref{eq:pore_pressure_gravity}
%\else
\fi
\subsubsection{Numerical Solution}
This problem is then solved using moose on a generated 3D mesh for the values bellow:
\begin{itemize}
\item Young's modulus $(E)=5e4$\
\item gravitational acceleration $g =-9.81$\
\item Poisson's ratio $(\nu) =0.2$\
\item $L=1$\
\item  solid density $(\rho=1)$\
\item solid compressibility $\beta=1.111111$
\item P\'{e}clet number $(Pe)=10$\
\item $K=27,777.8$
\item $G=20,833.333$
\end{itemize}
 a comparison of the numerical results against the analytical solution are shown in the figure\ref{fig:gravity_Poro_stress}
 \begin{figure}
  \centering
  \includegraphics[width=0.48\textwidth]{gravity/gravity_gravity_poro_stress_stress_xx}
  \includegraphics[width=0.48\textwidth]{gravity/gravity_gravity_poro_stress_stress_zz}\\
  \caption{ a comparison of the numerical results against the analytical solution are shown in the figure \ref{fig:gravity_rho_g_h} gravity changes the stress and taking into account pore pressure. }
  \label{fig:gravity_Poro_stress}
\end{figure}

\appendix
\chapter{Derivations}
\label{chapter:derivations}
This chapter documents some of the derivations used to obtain the equations presented in Sec.\ref{chapter:gov_eqs}.

\section{Mass balance}
\label{sec:mass_balance}
We define the following densities
\begin{subequations}
  \label{eq:rho_1_rho_2}
  \begin{align}
    \rho_1 &= (1-\phi)\rho_s \\
    \rho_2 &= \phi \: \rho_f
  \end{align}
\end{subequations}

and we use the usual material derivative definition
\begin{equation}
  \label{eq:material_derivative}
  \frac{D^{(i)}.}{D t} = \frac{\partial.}{\partial t} + v^{(i)}_k \frac{\partial.}{\partial x_k}
\end{equation}


\underline{Mass balance for the fluid phase}
\begin{equation}
  \label{eq:fluid_mass_balance_1}
  \frac{\partial \rho_2}{\partial t} + \frac{\partial( \rho_2 V^{(2)}_k)}{\partial x_k}= j_1
\end{equation}

Using Eq.~\ref{eq:rho_1_rho_2}b in Eq.~\ref{eq:fluid_mass_balance_1} we get
\begin{equation}
  \label{eq:fluid_mass_balance_2}
  \phi \frac{\partial \rho_f }{\partial t} + \rho_f\frac{\partial \phi }{\partial t} + \rho_f\frac{\partial( \phi V^{(2)}_k)}{\partial x_k}+ \phi V^{(2)}_k\frac{\partial\rho_f}{\partial x_k} = j_1
\end{equation}
Dividing by $\rho_f$ we obtain
\begin{equation}
  \label{eq:fluid_mass_balance}
  \frac{\phi}{\rho_f} \frac{D^{(2)} \rho_f }{D t} + \frac{\partial \phi }{\partial t} + \frac{\partial( \phi V^{(2)}_k)}{\partial x_k} = \frac{j_1}{\rho_f}
\end{equation}


\underline{Mass balance for the solid phase}
\begin{equation}
  \label{eq:solid_mass_balance_1}
  \frac{\partial \rho_1}{\partial t} + \frac{\partial( \rho_1 V^{(1)}_k)}{\partial x_k}= -j_1
\end{equation}
Using Eq.~\ref{eq:rho_1_rho_2}a in Eq.~\ref{eq:solid_mass_balance_1} we get
\begin{equation}
  \label{eq:solid_mass_balance_2}
  (1-\phi) \frac{\partial \rho_s }{\partial t} - \rho_s\frac{\partial \phi }{\partial t} + \rho_s\frac{\partial( (1-\phi) V^{(1)}_k)}{\partial x_k}+ (1-\phi) V^{(1)}_k\frac{\partial\rho_s}{\partial x_k} = -j_1
\end{equation}
Dividing by $\rho_s$ we obtain
\begin{equation}
  \label{eq:solid_mass_balance}
  \frac{(1-\phi)}{\rho_s} \frac{D^{(1)} \rho_s }{D t} - \frac{\partial \phi }{\partial t} + \frac{\partial(V^{(1)}_k)}{\partial x_k} - \frac{\partial( \phi V^{(1)}_k)}{\partial x_k} = -\frac{j_1}{\rho_s}
\end{equation}

\underline{Mass balance for the mixture (solid + fluid)}

Adding Eq.~\ref{eq:fluid_mass_balance} and Eq.~\ref{eq:solid_mass_balance} gives the mixture mass balance:
\begin{equation}
  \label{eq:mixture_mass_balance}
  \frac{(1-\phi)}{\rho_s} \frac{D^{(1)} \rho_s }{D t} +\frac{\phi}{\rho_f} \frac{D^{(2)} \rho_f }{D t} + \frac{\partial( \phi (V^{(2)}_k -V^{(1)}_k))}{\partial x_k}+ \frac{\partial(V^{(1)}_k)}{\partial x_k}  = \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{equation}

\underline{Equation of state (EOS)}

\begin{equation}
  \label{eq:density_derivative}
  \frac{d\rho_{(i)}}{\rho_{(i)}} = \left( \frac{d\rho_{(i)}}{dp_f} \right)_T \frac{dp_f}{\rho_{(i)}} +\left( \frac{d\rho_{(i)}}{dT} \right)_p \frac{dT}{\rho_{(i)}}, \:\:\:i\in \{s,f\}
\end{equation}

Using the definition for compressibility $\beta_{(i)}=\frac{1}{\rho_{(i)}}\left( \frac{d\rho_{(i)}}{dp_f} \right)_T$ and thermal expansion $\lambda_{(i)}=-\frac{1}{\rho_{(i)}}\left( \frac{d\rho_{(i)}}{dT} \right)_{p_f}$ we get the Equation of State (EOS)

\begin{equation}
  \label{eq:eos_def}
  \frac{d\rho_{(i)}}{\rho_{(i)}} = \beta_{(i)} dp_f - \lambda_{(i)} dT, \:\:\:i\in \{s,f\}
\end{equation}

Using Eq.~\ref{eq:eos_def} in Eq.~\ref{eq:mixture_mass_balance} leads to
\begin{multline}
  \label{eq:mixture_mass_balance2}
  (1-\phi) \left[ \beta_s \frac{D^{(1)}p_f}{Dt} - \lambda_s\frac{D^{(1)}T}{Dt}  \right] + \phi \left[ \beta_f \frac{D^{(2)}p_f}{Dt} - \lambda_f\frac{D^{(2)}T}{Dt}  \right] \\
  + \frac{\partial( \phi (V^{(2)}_k -V^{(1)}_k))}{\partial x_k}+ \frac{\partial(V^{(1)}_k)}{\partial x_k}  = \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{multline}
Rearranging the terms we get
\begin{multline}
  \label{eq:mixture_mass_balance3}
  \overbrace{\left[(1-\phi)\beta_s + \phi\beta_f\right]}^{\beta_m}  \frac{\partial p_f}{\partial t}
  - \overbrace{\left[(1-\phi)\lambda_s + \phi\lambda_f\right]}^{\lambda_m} \frac{\partial T}{\partial t} \\
  + \left[(1-\phi)\beta_s V^{(1)}_k + \phi\beta_f V^{(2)}_k \right] \frac{\partial p_f}{\partial x_k}
  - \left[(1-\phi)\lambda_s V^{(1)}_k + \phi\lambda_f V^{(2)}_k \right] \frac{\partial T}{\partial x_k} \\
  + \frac{\partial( \phi (V^{(2)}_k -V^{(1)}_k))}{\partial x_k}+ \frac{\partial(V^{(1)}_k)}{\partial x_k}  = \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{multline}

\underline{Normalisation}

In order to deal with dimensionless parameters we introduce the following normalised variables
\begin{subequations}
  \label{eq:def_normalisations}
  \begin{align}
  p^* &= \frac{p_f}{\sigma_{ref}}, \\
  T^* &= \frac{T-T_{ref}}{\delta T_{ref}}, \\
  x^* &= \frac{x}{x_{ref}}, \\
  t^* &= \frac{c_{th,ref}}{x^2_{ref}}t, \\
  V^* &= \frac{V}{V_{ref}}.
  \end{align}
\end{subequations}

where $c_{th,ref} = \alpha / \left( \rho C_p \right)_m$ is a reference thermal diffusivity of the mixture. Dividing Eq.~\ref{eq:mixture_mass_balance3} by $\beta_m$ and switching to the normalised variables we get

\begin{multline}
  \label{eq:mixture_mass_balance4}
  \frac{\sigma_{ref} \: c_{th,ref}}{x^2_{ref}} \frac{\partial p^*}{\partial t^*}
  - \frac{\lambda_m \: \delta \: T_{ref} \: c_{th,ref}}{\beta_m\:x^2_{ref}} \frac{\partial T^*}{\partial t^*} \\
  + \frac{V_{ref} \: \sigma_{ref}}{x_{ref}}\left[\frac{(1-\phi)\beta_s V^{*(1)}_k + \phi\beta_f V^{*(2)}_k}{\beta_m} \right] \frac{\partial p^*}{\partial x^*_k} \\
  - \frac{V_{ref}\:\delta\:T_{ref}}{x_{ref}}\left[\frac{(1-\phi)\lambda_s V^{*(1)}_k + \phi\lambda_f V^{*(2)}_k}{\beta_m} \right] \frac{\partial T*}{\partial x^*_k} \\
  + \frac{V_{ref}}{\beta_m\:x_{ref}} \frac{\partial( \phi (V^{*(2)}_k -V^{*(1)}_k))}{\partial x^*_k}
  + \frac{V_{ref}}{\beta_m\:x_{ref}} \frac{\partial(V^{*(1)}_k)}{\partial x^*_k}
  = \frac{1}{\beta_m} \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{multline}

This can be rewritten as

\begin{multline}
  \label{eq:mixture_mass_balance5}
  \frac{\partial p^*}{\partial t^*}
  - \overbrace{\frac{\lambda_m \: \delta \: T_{ref}}{\beta_m\:\sigma_{ref}}}^{\Lambda} \frac{\partial T^*}{\partial t^*}
  + \overbrace{\frac{x_{ref}\:V_{ref}}{c_{th,ref}}}^{Pe}  \overbrace{\left[\frac{(1-\phi)(\sigma_{ref}\beta_s) V^{*(1)}_k + \phi(\sigma_{ref}\beta_f) V^{*(2)}_k}{\sigma_{ref}\beta_m} \right]}^{\vec{v}^p} \frac{\partial p^*}{\partial x^*_k} \\
  - \overbrace{\frac{x_{ref}\:V_{ref}}{c_{th,ref}}}^{Pe} \overbrace{\left[\frac{(1-\phi)(\delta\:T_{ref}\lambda_s) V^{*(1)}_k + \phi(\delta\:T_{ref}\lambda_f) V^{*(2)}_k}{\sigma_{ref}\beta_m} \right]}^{\vec{v}^T} \frac{\partial T*}{\partial x^*_k} \\
  + \frac{x_{ref}\:V_{ref}}{c_{th,ref}\:\beta_m\:\sigma_{ref}}  \frac{\partial}{\partial x^*_k} \underbrace{\left[ \phi (V^{*(2)}_k -V^{*(1)}_k)\right]}_{\text{norm. filtration vec.}}
  + \underbrace{\frac{x_{ref}\:V_{ref}}{c_{th,ref}}}_{Pe} \frac{1}{\beta_m\:\sigma_{ref}} \underbrace{\frac{\partial(V^{*(1)}_k)}{\partial x^*_k}}_{\dot{\epsilon}^*_V}  \\
  = \frac{x^2_{ref}}{\beta_m\:\sigma_{ref}\:c_{th,ref}} \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{multline}

with

\begin{subequations}
  \label{eq:def_parameters}
  \begin{align}
  \Lambda &= \frac{\lambda_m \: \delta \: T_{ref}}{\beta_m\:\sigma_{ref}}=\frac{\lambda^*_m}{\beta^*_m}, \\
  \lambda^*_i &= \delta \: T_{ref} \:\lambda_i, \:\:\: i\in\{s,f,m\}\\
  \beta^*_i &= \beta \: \sigma_{ref}, \:\:\: i\in\{s,f,m\}\\
  Pe &= \frac{x_{ref}\:V_{ref}}{c_{th,ref}}, \\
  v^p &= \frac{(1-\phi)\beta^*_s V^{*(1)}_k + \phi\beta^*_f V^{*(2)}_k}{\beta^*_m}, \\
  v^T &= \frac{(1-\phi)\lambda^*_s V^{*(1)}_k + \phi\lambda^*_f V^{*(2)}_k}{\beta^*_m}.
  \end{align}
\end{subequations}

The filtration vector $\phi(V^{(2)}_k -V^{(1)}_k)$ can be expressed using Darcy's law as
\begin{equation}
  \label{eq:darcy}
  \phi(V^{(2)}_k -V^{(1)}_k) = -\frac{\kappa}{\mu_f} \left(\frac{\partial p_f}{\partial x_k} - \rho_f\:g\:\vec{e}_z \right)
\end{equation}

In its normalised form it becomes
\begin{equation}
  \label{eq:darcy_normalised}
  \phi(V^{*(2)}_k -V^{*(1)}_k)
  = -\frac{\kappa}{\mu_f} \frac{\sigma_{ref}}{x_{ref}\:V_{ref}}\left(\frac{\partial p^*}{\partial x^*_k} - \frac{x_{ref}}{\sigma_{ref}}\rho_f\:g\:\vec{e}_z \right)
\end{equation}

The mass balance equation then becomes
\begin{multline}
  \label{eq:mixture_mass_balance6}
  \frac{\partial p^*}{\partial t^*}
  - \Lambda \frac{\partial T^*}{\partial t^*}
  + Pe \:\vec{v}^p \frac{\partial p^*}{\partial x^*_k}
  - Pe \:\vec{v}^T \frac{\partial T*}{\partial x^*_k} \\
  + \frac{\partial}{\partial x^*_k} \left[ \underbrace{\frac{\kappa \: \sigma_{ref}}{\mu_f\:c_{th,ref}\:\beta^*_m}}_{1/Le} \left( \frac{\partial p^*}{\partial x^*_k} - \underbrace{\rho_f \frac{x_{ref}}{\sigma_{ref}}g}_{(\rho_f\:g)^*}\: \vec{e}_z  \right) \right]
  + \frac{Pe}{\beta^*_m} \dot{\epsilon}^*_V
  = \frac{x^2_{ref}}{\beta_m\:\sigma_{ref}\:c_{th,ref}} \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1
\end{multline}

with the Lewis number defined as $Le = \frac{\mu_f\:c_{th,ref}\:\beta^*_m}{\kappa \: \sigma_{ref}}$ and the normalised gravity term $(\rho_f\:g)^*=\rho_f \frac{x_{ref}}{\sigma_{ref}}g$.

Following \citep[][appendix A]{Alevizos2014}
$j_1 = \omega_F.M_B$, $\omega_F=\frac{\rho_1}{M_{AB}}k_F exp{-\Delta H_{act}^F/RT}$ and $\rho_1=(1-\phi)(1-s)\rho_{AB}$, so the volumetric source term $j_1$ can be written as
\begin{equation}
  \label{eq:j1_a}
  j_1 =\rho_{AB}\frac{M_B}{M_{AB}}(1-\phi)(1-s) k_F exp{(-\Delta H_{act}^F/RT)}
\end{equation}
The RHS term of Eq.~\ref{eq:mixture_mass_balance6} can then be written as
\begin{multline}
  \label{eq:mixture_mass_balance_rhs}
  \frac{x^2_{ref}}{\beta_m\:\sigma_{ref}\:c_{th,ref}} \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)j_1 = \frac{x^2_{ref}}{\beta_m\:\sigma_{ref}\:c_{th,ref}} \left(\frac{1}{\rho_f} - \frac{1}{\rho_s}\right)\rho_{AB}\frac{M_B}{M_{AB}}(1-\phi)(1-s) k_F exp{(-\Delta H_{act}^F/RT)} \\
  = \underbrace{\frac{x^2_{ref}k_F }{\beta_m\:\sigma_{ref}\:c_{th,ref}} \frac{\rho_{AB}}{\rho_B}\frac{M_B}{M_{AB}}\left(\frac{\rho_B}{\rho_f} - \frac{\rho_B}{\rho_s}\right)e^{-Ar_F}}_{1/Le_{chem}} \underbrace{(1-\phi)(1-s) \exp{\left( \frac{Ar_F \:\delta T^*}{1+\delta T^*} \right)}}_{\omega^*_F }
\end{multline}

We then arrive to the full mass balance equation Eq.~\ref{eq:final_system_of_equations_dimensionless}b

\section{Energy balance}
\label{sec:energy_balance}
The local form of the energy balance equation reads as follows:
\begin{equation}
  \label{eq:energy_balance}
  (\rho C_p)_m \frac{D^{(m)}T}{Dt} = \nabla \left(\alpha \nabla T\right) + \chi \sigma_{ij}.\dot{\epsilon}^{p}_{ij} - \Delta H (\omega_F - \omega_R)
\end{equation}
with $\chi$ the Taylor-Quinney coefficient and {\color{red} $\Delta H_{r}=\Delta \mathfrak{E} = \mathfrak{E}_F - \mathfrak{E}_R$ the reaction's specific enthalpy}.
The definitions of the reaction rates $\omega_F$ and $\omega_R$ are (from Eq.~\ref{eq:reaction_rate_total})
\begin{subequations}
 \label{eq:reaction_rates}
 \begin{align}
 \omega_F &= k_F (1 - s)(1 - \phi)\frac{\rho_{AB}}{M_{AB}}  e^{-\Delta H_{act}^F/RT} \\
 \omega_R &= k_R \:s  (1 - \phi)  \Delta \phi_{chem} \frac{\rho_{A} \rho_{B}}{\rho_{AB}} \frac{M_{AB}}{M_A M_B}  e^{-\Delta H_{act}^R/RT}
  \end{align}
\end{subequations}

Using the normalised variable we get
\begin{multline}
  \label{eq:energy_balance1}
  \frac{\delta T_{ref}\:c_{th,ref}}{x^2_{ref}}(\rho C_p)_m \frac{\partial T^*}{\partial t^*} + \frac{\delta T_{ref}\:v_{ref}}{x_{ref}}(\rho C_p)_m \:\bar{v}\:\frac{\partial T^*}{\partial x^*} \\
  - \nabla\left(\frac{\alpha\:\delta T_{ref}}{x^2_{ref}} \nabla T\right) - \frac{\sigma_{ref}\:c_{th,ref}}{x^2_{ref}} \chi \sigma^*_{ij}\:\dot{\epsilon}^{*(p)}_{ij} \\
  - \Delta H_{r}\:k_F (1 - s)(1 - \phi)\frac{\rho_{AB}}{M_{AB}}  e^{-\Delta H_{act}^F/RT} \\
  + \Delta H_{r}\:k_R \:s  (1 - \phi)  \Delta \phi_{chem} \frac{\rho_{A} \rho_{B}}{\rho_{AB}} \frac{M_{AB}}{M_A M_B}  e^{-\Delta H_{act}^R/RT} = 0
\end{multline}

Note that the reference strain rate is also rescaled so
\begin{equation}
  \dot{\epsilon}^*_0 = \dot{\epsilon}_0 \frac{x^2_{ref}}{c_{th,ref}}
\end{equation}

This leads to
\begin{multline}
  \label{eq:energy_balance2}
  \frac{\partial T^*}{\partial t^*} + \overbrace{\frac{x_{ref}\:v_{ref}}{c_{th}}}^{Pe}\:\bar{v}\:\frac{\partial T^*}{\partial x^*} - \nabla\left(\overbrace{\frac{\alpha}{(\rho C_p)_m}}^{c_{th}}\frac{1}{c_{th,ref}} \nabla T\right) - \overbrace{\frac{\sigma_{ref}}{\delta T_{ref}(\rho C_p)_m} \chi}^{Gr} \sigma^*_{ij}\:\dot{\epsilon}^{*(p)}_{ij} \\
  - \underbrace{\frac{\Delta H_{r}\:x^2_{ref} k_F }{\delta T_{ref}\:c_{th,ref}(\rho C_p)_m}\frac{\rho_{AB}}{M_{AB}}e^{-Ar_F}}_{Da_{endo}} (1 - s)(1 - \phi)e^{\frac{Ar_F\:\delta T^*}{1+\delta T^*}} \\
   + \underbrace{\frac{\Delta H_{r}\:x^2_{ref} k_R}{\delta T_{ref}\:c_{th,ref}(\rho C_p)_m} \frac{\rho_{A} \rho_{B}}{\rho_{AB}} \frac{M_{AB}}{M_A M_B} e^{-Ar_R}}_{Da_{exo}}\:s  (1 - \phi)\Delta \phi_{chem} e^{\frac{Ar_R\:\delta T^*}{1+\delta T^*}}= 0
\end{multline}
and finally to Eq.~\ref{eq:final_system_of_equations_dimensionless}c with $c^*_{th}=\frac{c_{th}}{c_{th,ref}}$.

\section{Jacobians}
Numerical convergence can be helped by providing the jacobians and off-diagonal terms for the kernel residuals, even though \moose{} does not explicitly require them. It is a trial-and-error process to check if the improvement in convergence justifies the cost of computing those terms. See the \moose{} workshop manual on \url{http://mooseframework.org/documentation/} for more details.


%\mathscr{R}
If $R(u)$ is the residual for the variable $u$, the jacobian matrix $J$ is defined as
\begin{equation}
  \label{eq:def_jacobian}
  J_{ij}(u) = \frac{\partial R_i(u)}{\partial u_j}
\end{equation}
and the off-diagonal jacobian term for another coupled variable $v$ as
\begin{equation}
  \label{eq:def_off_diag_jacobian}
  J^{(\text{off diag})}_{ij}(u) = \frac{\partial R_i(u)}{\partial v_j}
\end{equation}

\subsection{RedbackMassConvection}
The residual is defined as
\begin{equation}
  R = Pe\: v^p.\nabla p^* - Pe\:v^T.\nabla T^*
\end{equation}
with (see Eq.\ref{eq:final_system_of_equations_dimensionless})
\begin{align*}
  v_i^p &= (1-\phi)\frac{\beta^*_s}{\beta^*_m} v_i^{*(s)} +
    \phi\frac{\beta^*_f}{\beta^*_m}v_i^{*(f)}, \\
  v^T_i &= (1-\phi)\frac{\lambda^*_s}{\beta^*_m} v_i^{*(s)} +
    \phi\frac{\lambda^*_f}{\beta^*_m} v_i^{*(f)}.
\end{align*}
Noting that $\frac{\partial \nabla u}{\partial u_j}=\nabla \phi_j$ for any variable $u$ (see \moose{} documentation),
\begin{equation}
  \label{eq:def_jac_mass_conv}
  J = \frac{\partial R}{\partial p^*} = Pe \frac{\partial v^p}{\partial p^*}.\nabla p^* + Pe\:v^p\:\nabla \phi_j - Pe\frac{\partial v^T}{\partial p^*}.\nabla T^*
\end{equation}
The normalised filtration vector (Eq.~\ref{eq:darcy_normalised}) can be rewritten as
\begin{equation}
 \label{eq:darcy_normalised2}
  \phi (v^{*(f)} - v^{*(s)}) = -\frac{\beta^*_m}{Le\:Pe} \left(\nabla p^* - \rho_f\:g^* \right)
\end{equation}

Deriving that equation and adding the equation of state (Eq.~\ref{eq:eos_def}) we get
\begin{equation}
  \frac{\partial (\phi v^{*(f)})}{\partial p^*} = -\frac{\beta^*_m}{Le\:Pe} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right)
\end{equation}
under the following simplifying assumptions:
\begin{itemize}
 \item $\frac{\partial v^{(s)}}{\partial p^*}=0$
 \item $\frac{\partial \mu_f}{\partial p^*}=0$
 \item $\frac{\partial \phi}{\partial p^*}=0$
\end{itemize}
Using $\frac{\partial \rho_f}{\partial p^*} = \beta^*_f \: \rho_f$ we get
\begin{subequations}
  \label{eq:derivatives_vT_vp}
  \begin{align}
     \frac{\partial v^p}{\partial p^*} &= -\frac{\beta^*_f}{Le\:Pe} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right) \\
  \frac{\partial v^T}{\partial p^*} &= -\frac{\lambda^*_f}{Le\:Pe} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right)
  \end{align}
\end{subequations}


Eq.~\ref{eq:def_jac_mass_conv} then becomes
\begin{subequations}
  \label{eq:jac_mass_conv1}
  \begin{align}
  J &= Pe \frac{\partial v^p}{\partial p^*}.\nabla p^*
  	+ Pe\:v^p\:\nabla \phi_j - Pe\frac{\partial v^T}{\partial p^*}.\nabla T^* \\ \nonumber
  	&= -\frac{1}{Le} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right) (\beta^*_f\nabla p^* - \lambda^*_f\nabla T^*) + Pe\:v^p\:\nabla \phi_j \\ \nonumber
  	&= \left( Pe\:v^p -\frac{1}{Le}(\beta^*_f\nabla p^* - \lambda^*_f\nabla T^*) \right)\nabla \phi_j + \frac{1}{Le} \beta^*_f\rho_f\:g^*(\beta^*_f\nabla p^* - \lambda^*_f\nabla T^*) \\ \nonumber
  \end{align}
\end{subequations}

Using $\frac{\partial \rho_f}{\partial T^*} = -\lambda^*_f \: \rho_f$ we get
\begin{subequations}
  \begin{align}
  \frac{\partial v^p}{\partial T^*} &= -\frac{\beta^*_f \lambda^*_f}{Le\:Pe} \rho_f\:g^* \\
  \frac{\partial v^T}{\partial T^*} &= -\frac{\lambda^{*2}_f}{Le\:Pe} \rho_f\:g^* \\
  \end{align}
\end{subequations}

The off-diagonal jacobian with respect to temperature is defined as
\begin{subequations}
  \label{eq:off_diag_jac_mass_conv1}
  \begin{align}
  J^T &= \frac{\partial R}{\partial T^*} = Pe \frac{\partial v^p}{\partial T^*}.\nabla p^* - Pe\:\frac{\partial v^T}{\partial T^*}\nabla T* - Pe\:v^T\:\nabla \phi_j \\ \nonumber
    &=  -\frac{\lambda^*_f}{Le} \rho_f\:g^* (\beta^*_f \nabla p^* - \lambda^*_f \nabla T*) - Pe\:v^T\:\nabla \phi_j \\ \nonumber
  \end{align}
\end{subequations}

\subsection{RedbackThermalConvection}
The residual is defined as
\begin{equation}
  R = Pe\: \bar{v}.\nabla T^*
\end{equation}
and the corresponding jacobian as
\begin{equation}
  \label{eq:def_jac_heat_conv}
  J = \frac{\partial R}{\partial T^*} = Pe \frac{\partial \bar{v}}{\partial T^*}.\nabla T^* + Pe\:\bar{v}\:\nabla \phi_j.
\end{equation}

From the definition of the normalised filtration velocity (Eq.~\ref{eq:darcy_normalised2}) we get
\begin{equation}
  \frac{\partial v^{*(f)}}{\partial T^*} = -\frac{\beta^*_m \lambda^*_f}{Le\:Pe\:\phi}\rho_f\:g^*
\end{equation}

From the definition of the mixture barycentric velocity $\bar{v} = \frac{\rho_s}{\bar{\rho}} v^{*(s)} + \frac{\rho_f}{\bar{\rho}} v^{*(f)}$ and following the same assumptions that led to Eq.~\ref{eq:derivatives_vT_vp} we write
\begin{subequations}
  \begin{align}
  \frac{\partial \bar{v}}{\partial T^*} &= -\frac{1}{\bar{\rho}^2}\frac{\partial \bar{\rho}}{\partial T^*} (\rho_s v^{*(s)} + \rho_f v^{*(f)}) + \frac{1}{\bar{\rho}} \left[ \frac{\partial \rho_s}{\partial T^*}v^{*(s)} +\frac{\partial \rho_f}{\partial T^*}v^{*(f)} +\rho_f\frac{\partial v^{*(f)}}{\partial T^*}  \right]\\ \nonumber
  &= -\frac{1}{\bar{\rho}}\frac{\partial \bar{\rho}}{\partial T^*}\bar{v} + \frac{1}{\bar{\rho}} \left[ \frac{\partial \rho_s}{\partial T^*}v^{*(s)} +\frac{\partial \rho_f}{\partial T^*}v^{*(f)} +\rho_f\frac{\partial v^{*(f)}}{\partial T^*}  \right]\\ \nonumber
  &= \frac{1}{\bar{\rho}}\left[(1-\phi)\lambda^{*(s)}\rho_s + \phi\lambda^{*(f)}\rho_s \right]\bar{v} - \frac{1}{\bar{\rho}} \left[ \lambda^{*(s)}\rho_s v^{*(s)} + \lambda^{*(f)}\rho_f v^{*(f)} \right] - \frac{\rho_f}{\bar{\rho}}\frac{\beta^*_m \lambda^*_f}{Le\:Pe\:\phi}\rho_f\:g^*  \\ \nonumber
  &= ... \\ \nonumber
  &= \frac{1}{\bar{\rho}}\left[ \lambda^*_m \rho_s \bar{v} - \lambda^*_s \rho_s v^{*(s)} - \lambda^*_f \rho_f v^{*(f)}    \right] - \frac{\rho_f}{\bar{\rho}}\frac{\beta^*_m \lambda^*_f}{Le\:Pe\:\phi}\rho_f\:g^*  \\ \nonumber
  \end{align}
\end{subequations}

For the off-diagonal term with respect to pore pressure we get
\begin{subequations}
  \begin{align}
  \frac{\partial \bar{v}}{\partial p^*} =& -\frac{1}{\bar{\rho}^2}\frac{\partial \bar{\rho}}{\partial p^*} (\rho_s v^{*(s)} + \rho_f v^{*(f)}) + \frac{1}{\bar{\rho}} \left[ \frac{\partial \rho_s}{\partial p^*}v^{*(s)} +\frac{\partial \rho_f}{\partial p^*}v^{*(f)} +\rho_f\frac{\partial v^{*(f)}}{\partial p^*}  \right]\\ \nonumber
  =& -\frac{1}{\bar{\rho}}\frac{\partial \bar{\rho}}{\partial p^*}\bar{v} + \frac{1}{\bar{\rho}} \left[ \frac{\partial \rho_s}{\partial p^*}v^{*(s)} +\frac{\partial \rho_f}{\partial p^*}v^{*(f)} +\rho_f\frac{\partial v^{*(f)}}{\partial p^*}  \right]\\ \nonumber
  =& -\frac{1}{\bar{\rho}}\left[(1-\phi)\beta^{*(s)}\rho_s + \phi\beta^{*(f)}\rho_s \right]\bar{v} + \frac{1}{\bar{\rho}} \left[ \beta^{*(s)}\rho_s v^{*(s)} + \beta^{*(f)}\rho_f v^{*(f)} \right] \\ \nonumber
  &- \frac{\rho_f}{\bar{\rho}}\frac{\beta^*_m}{Le\:Pe\:\phi} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right)  \\ \nonumber
  =& ... \\ \nonumber
  =& \frac{1}{\bar{\rho}}\left[ -\beta^*_m \rho_s \bar{v} + \beta^*_s \rho_s v^{*(s)} + \beta^*_f \rho_f v^{*(f)}    \right] - \frac{\rho_f}{\bar{\rho}}\frac{\beta^*_m}{Le\:Pe\:\phi} \left(\nabla \phi_j - \beta^*_f\rho_f\:g^* \right)  \\ \nonumber
  \end{align}
\end{subequations}

\chapter{Symbols}
Tab.~\ref{tab:symbols} lists some of the main symbols used in this document.

{\footnotesize
\begin{longtable}{ l l l }
\caption{List of main symbols} \label{tab:symbols} \\
\hline \multicolumn{1}{l}{Symbol} & \multicolumn{1}{l}{Name} & \multicolumn{1}{l}{Unit of measure} \\ \hline
\endfirsthead

\multicolumn{3}{c}%
{{\thetable{} -- continued from previous page}} \\
\hline \multicolumn{1}{l}{Symbol} & \multicolumn{1}{l}{Name} & \multicolumn{1}{l}{Unit of measure}  \\ \hline
\endhead

\hline\hline \multicolumn{3}{r}{{Continued on next page}} \\ \hline\hline
\endfoot

\hline \hline
\endlastfoot

%\small
%\begin{tabular}{l c l c l c l}
%\hline\noalign{\smallskip}
%\hline
%Symbol & Name & Unit of Measure \\ \hline
%\noalign{\smallskip}\hline\noalign{\smallskip}
% Dimensionless groups
$Ar$ & Arrhenius number & - \\
$Ar_F$ & Forward Arrhenius number & - \\
$Ar_R$ & Reverse Arrhenius number & - \\
$Da_{endo}$ & Endothermic Damk\"{o}hler number & - \\
$Da_{exo}$ & Exothermic Damk\"{o}hler number & - \\
$Gr$ & Gruntfest number & - \\
$\bar{\Lambda}$ & Thermal pressurization coefficient & - \\
$Le$ & Lewis number &  - \\
$Le_{chem}$ & Chemical Lewis number &  - \\
$Pe$ & P\'{e}clet number & - \\
\hline

% stars
$.^{\star}$, [$t^{\star}$, $x^{\star}$, $T^{\star}$, $\Delta p^{\star}$, $\sigma^{\star}_{ij}$] & Normalized variables [time, space, temperature, \\ & pore pressure increase, stress]& - \\

\hline
% Greek symbols
$\alpha$ & Thermal conductivity & $ kg.m.K^{-1}.s^{-3}$ \\
$\beta$, [$\beta_s$, $\beta_f$] & Compressibility [solid, fluid phase] & $Pa^{-1}$ \\
$\delta$ & Numerical rescaling parameter & - \\
$\delta_{ij}$ & Kronecker delta & - \\
$\Delta H$, [$\Delta H_r$,$\Delta H^{F}_{act}$, & Change of specific enthalpy [enthalpy of reaction, \\ $\;\;\;\;\;\;\;\;$ $\Delta H^{R}_{act}$, $\Delta H_{mech}$] & activation enthalpy of forward, reverse reaction] & $J.mol^{-1}$ \\
$\epsilon_{ij}$ & Strain tensor & - \\
$\dot{\epsilon}_{ij}$ & Strain rate tensor & $s^{-1}$ \\
$\dot{\epsilon}$, [$\dot \epsilon_0$, $\dot \epsilon^{vp}_{d}$, $\dot \epsilon^{vp}_{v}$] & Strain rate [reference, deviatoric visco-plastic, \\ & volumetric visco-plastic] & $s^{-1}$ \\
$\zeta$, [$\zeta_{1}$, $\zeta_{2}$, $\zeta_{3}$] & Stoichiometric coefficients \\ & [of species AB, A, B] from Eq.~\ref{eq:reaction}& - \\
$\kappa$ & Permeability & $m^2$ \\
$\lambda$, [$\lambda_s$, $\lambda_f$] & Thermal expansion coefficient [solid, fluid phase] & $K^{-1}$ \\
$\mu_f$ & Fluid viscosity & $Pa.s$ \\
$\nu$ & Poisson's ratio & - \\
$\dot\Pi$ & Plastic multiplier (scalar) & $s^{-1}$ \\
$\rho$, [$\rho_{AB}$, $\rho_{A}$, $\rho_{B}$, $\rho_{s}$,  & Density [of species AB, A, B, solid, fluid, \\ $\;\;\;\;$ $\rho_{f}$, $\rho_{1}$, $\rho_{2}$] & solid phase, fluid phase] & $kg.m^{-3}$ \\
$\sigma_{ij}$, [$\sigma'_{ij}$] & Stress tensor [effective stress] & $Pa$ \\
$\phi$, [$\phi_0$, $\Delta\phi_{chem}$, $\Delta\phi_{mech}$] & Porosity [initial, chemical component, \\ & mechanical component] & - \\
$\chi$ & Taylor-Quinney coefficient & - \\
$\omega$, [$\omega_{AB}$, $\omega_{A}$, $\omega_{B}$, $\omega_{F}$, $\omega_{R}$] & Molar reaction rates [of species AB, A, B, \\ & forward, reverse] & $mol.m^{-3}.s^{-1}$ \\

\hline
% Latin symbols - Upper case
$A_{\phi}$ & Interconnected porosity coefficient & - \\
$C^e_{ijkl}$ & Elasticity tensor & $Pa$ \\
$C_p$ & Specific heat capacity & $m^2.K^{-1}.s^{-2}$ \\
$E$ & Young's modulus & $Pa$ \\
$\mathfrak{E}$ & Activation energy & $J.mol^{-1}$ \\
$G$ & Shear modulus & $Pa$ \\
$K$ & Bulk modulus & $Pa$ \\
$K_c$ & Relative pre-exponential factor & - \\
$M$, [$M_{AB}$, $M_{A}$, $M_{B}$] & Molar mass [of species AB, A, B] & $kg.mol^{-1}$ \\
%$Q$, [$Q_{F}$, $Q_{R}$, $\Delta H_{mech}$] & Activation enthalpy [forward chemical reaction, \\
%     & reverse, of micro-mechanical processes] & $J.mol^{-1}$ \\
$R$ & Universal gas constant & $J.K^{-1}.mol^{-1}$ \\
$T$ & Temperature & $K$ \\
$V$, [$V_{s}$, $V_{f}$, $V_{A}$, $V_{B}$, & Volume [of solid phase, fluid phase, \\ $\;\;\;\;\;$ $V_{AB}$, $V_{act}$] & component A, B, AB, activation volume] & $m^3$ \\

\hline
% Latin symbols - Lower case
$b_{i}$ & Body force vector & $m^{2}.s^{-1}$ \\
$c_{th}$ & Thermal diffusivity & $m^{2}.s^{-1}$ \\
$j$, [$j_1$, $j_2$] & Mass production rate per unit volume [solid, \\ & fluid phase] & $kg.m^{-3}.s^{-1}$ \\
$k$, [$k_{F}$, $k_{R}$, $k_{A}$, $k_{B}$] & Pre-exponential factor [of forward, reverse \\ & chemical reaction, for species A, B] & $s^{-1}$\\
$m$ & Visco-plasticity power law exponent & - \\
$p$, [$p_Y$] & Volumetric mean stress [value at yield] & $Pa$ \\
$p_f$ & Pore fluid pressure & $Pa$ \\
$q$, [$q_Y$] & Equivalent stress [value at yield] & $Pa$ \\
$f$ & Yield function & $\mathbb{R}^9 \longrightarrow \mathbb{R}$ \\
$s$ & partial solid ratio & - \\
$v_i$, [$v_i^s$, $v_i^f$, $\bar{v}_i^{m}$, $\bar{v}_i^{\beta}$, $\bar{v}_i^{\Lambda}$] & Velocity vector [solid, fluid phase, average velocity \\ & of the mixture with respect to mass (barycentric), \\ & compressibility, thermal pressurisation ] & $m.s^{-1}$ \\

%\noalign{\smallskip}\hline
%\end{tabular}
\end{longtable}
}


%\addcontentsline{toc}{chapter}{\numberline{}Bibliography}
%\bibliographystyle{unsrt}
%\begin{thebibliography}{99}
%\bibitem{richards1931}LA Richards ``Capillary conduction of
%  liquids through porous mediums''   Physics 1 (1931) pp 318--333
%\end{thebibliography}

\bibliographystyle{aps-nameyear}      % American Physical Society (APS) style, author-year citations
\bibliography{redback}                % name your BibTeX data base
\nocite{*}

\end{document}

